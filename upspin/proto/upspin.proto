// Copyright 2016 The Upspin Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

syntax = "proto3";

package proto;

// Endpoint mirrors upspin.Endpoint.
message Endpoint {
    int32 transport = 1;
    string net_addr = 2;
}

// Location mirrors upspin.Location.
message Location {
    Endpoint endpoint = 1;
    string reference = 2;
}

// The Service interface.

message AuthenticateRequest {
    string user_name = 1;
    string now = 2;
    Signature signature = 3;
}

message Signature {
    string r = 1;
    string s = 2;
}

message AuthenticateResponse {
    string token = 1;
}

message ConfigureRequest {
    repeated string options = 1;
}

message ConfigureResponse {
}

message EndpointRequest {
}

message EndpointResponse {
    Endpoint endpoint = 1;
}

message PingRequest {
    int32 ping_sequence = 1;
}

message PingResponse {
    int32 ping_sequence = 1;
}

// The Store interface.

message StoreGetRequest {
    string reference = 1;
}

message StoreGetResponse {
    bytes data = 1;
    repeated Location locations = 2;
}

message StorePutRequest {
    bytes data = 1;
}

message StorePutResponse {
    string reference = 1;
}

message StoreDeleteRequest {
    string reference = 1;
}

message StoreDeleteResponse {
}

service Store {
    // Service methods:
    rpc Authenticate (AuthenticateRequest) returns (AuthenticateResponse) {}
    rpc Configure (ConfigureRequest) returns (ConfigureResponse) {}
    rpc Endpoint (EndpointRequest) returns (EndpointResponse) {}
    rpc Ping (PingRequest) returns (PingResponse) {}

    rpc Get (StoreGetRequest) returns (StoreGetResponse) {}
    rpc Put (StorePutRequest) returns (StorePutResponse) {}
    rpc Delete (StoreDeleteRequest) returns (StoreDeleteResponse) {}
}

// The User interface.

message UserLookupRequest {
    string UserName = 1;
}

message UserLookupResponse {
    repeated Endpoint Endpoints = 1;
    repeated string PublicKeys = 2;
}

service User {
    // Service methods:
    rpc Authenticate (AuthenticateRequest) returns (AuthenticateResponse) {}
    rpc Configure (ConfigureRequest) returns (ConfigureResponse) {}
    rpc Endpoint (EndpointRequest) returns (EndpointResponse) {}
    rpc Ping (PingRequest) returns (PingResponse) {}

    rpc Lookup (UserLookupRequest) returns (UserLookupResponse) {}
}

// The Directory interface.
// DirEntry values are stored as bytes, for simple and fast marshaling.

message DirectoryLookupRequest {
	string Name = 1;
}

message DirectoryLookupResponse {
	bytes Entry = 1;
}

message DirectoryPutRequest {
	bytes Entry = 1;
}

message DirectoryPutResponse {
}

message DirectoryMakeDirectoryRequest {
	string Name = 1;
}

message DirectoryMakeDirectoryResponse {
	Location Location = 1;
}

message DirectoryGlobRequest {
	string Pattern = 1;
}

message DirectoryGlobResponse {
	repeated bytes Entries = 1;
}

message DirectoryDeleteRequest {
	string Name = 1;
}

message DirectoryDeleteResponse {
}

message DirectoryWhichAccessRequest {
	string Name = 1;
}

message DirectoryWhichAccessResponse {
	string Name = 1;
}

service Directory {
    // Service methods:
    rpc Authenticate (AuthenticateRequest) returns (AuthenticateResponse) {}
    rpc Configure (ConfigureRequest) returns (ConfigureResponse) {}
    rpc Endpoint (EndpointRequest) returns (EndpointResponse) {}
    rpc Ping (PingRequest) returns (PingResponse) {}

    rpc Lookup (DirectoryLookupRequest) returns (DirectoryLookupResponse) {}
    rpc Put (DirectoryPutRequest) returns (DirectoryPutResponse) {}
    rpc MakeDirectory (DirectoryMakeDirectoryRequest) returns (DirectoryMakeDirectoryResponse) {}
    rpc Glob (DirectoryGlobRequest) returns (DirectoryGlobResponse) {}
    rpc Delete (DirectoryDeleteRequest) returns (DirectoryDeleteResponse) {}
    rpc WhichAccess (DirectoryWhichAccessRequest) returns (DirectoryWhichAccessResponse) {}
}
