{
  "comments": [
    {
      "key": {
        "uuid": "1cc08615_32a856f9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 5770
      },
      "writtenOn": "2017-07-01T06:13:31Z",
      "side": 1,
      "message": "This is a question that comes to mind, I\u0027d like to ask it.\n\nThis CL seems to fix pretty significant issues, yet the tests only failed on CI servers, and only sometimes. Is there anything that could be done to improve the tests and make them catch these issues (if they were to regress) even when run on our local dev machines (where they currently pass every time)?",
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eca59375_0dac1360",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 5389
      },
      "writtenOn": "2017-07-02T10:25:54Z",
      "side": 1,
      "message": "You\u0027re right, there should be more tests. I added some tests for the behavior of Tree.PutDir. Thanks for prompting me.\n\nI don\u0027t think we need to test for the race conditionÂ itself, as snapshot creation is entirely performed within PutDir with the tree lock held. Any test for the race would be a test fo Go\u0027s sync.Mutex implementation, which is already well-tested.",
      "parentUuid": "1cc08615_32a856f9",
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8e7f6685_f4e848bc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 5770
      },
      "writtenOn": "2017-07-02T21:25:57Z",
      "side": 1,
      "message": "Thanks for doing that. I can confirm all 3 tests/changes you\u0027ve made in dir/server/tree/all_test.go reliably fail for me on master on macOS, yet they\u0027re passing on this branch. That helps with confidence.",
      "parentUuid": "eca59375_0dac1360",
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7bc3d364_db353737",
        "filename": "test/snapshot_test.go",
        "patchSetId": 4
      },
      "lineNbr": 76,
      "author": {
        "id": 5770
      },
      "writtenOn": "2017-07-01T06:08:15Z",
      "side": 1,
      "message": "Is this comment out of date, given the GetNEvents(2) -\u003e GetNEvents(1) change below?",
      "range": {
        "startLine": 76,
        "startChar": 28,
        "endLine": 76,
        "endChar": 47
      },
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f37de71_89c7c5c7",
        "filename": "test/snapshot_test.go",
        "patchSetId": 4
      },
      "lineNbr": 76,
      "author": {
        "id": 5389
      },
      "writtenOn": "2017-07-02T10:25:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7bc3d364_db353737",
      "range": {
        "startLine": 76,
        "startChar": 28,
        "endLine": 76,
        "endChar": 47
      },
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf9fd8c9_fbeb1fee",
        "filename": "test/snapshot_test.go",
        "patchSetId": 4
      },
      "lineNbr": 146,
      "author": {
        "id": 5770
      },
      "writtenOn": "2017-07-02T21:25:57Z",
      "side": 1,
      "message": "Andrew, can you explain the motivation for change on this line please?\n\nI ask because I have a potential concern about it, but I can\u0027t tell if it\u0027s real because I don\u0027t understand what\u0027s meant to be done here. debugFailure is not documented, aside from \"// TODO: remove.\", and I read the entire commit message but did not find an explanation for this change.",
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "429a3dac_84e94e1a",
        "filename": "test/snapshot_test.go",
        "patchSetId": 4
      },
      "lineNbr": 146,
      "author": {
        "id": 5389
      },
      "writtenOn": "2017-07-02T21:31:53Z",
      "side": 1,
      "message": "Basically this is similar to the change in this CL\nhttps://upspin-review.googlesource.com/c/10500/2/test/snapshot_test.go#147\nwhich was submitted after I started working on this. It\u0027s to prevent a failure in looking up a directory from failing the test, when all debugFailure is supposed to do is print diagnostics to aid in debugging this exact issue. Once this fix is in and we observe the flakiness to have gone away, we can remove this function.",
      "parentUuid": "cf9fd8c9_fbeb1fee",
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed21dc31_a4e9564f",
        "filename": "test/snapshot_test.go",
        "patchSetId": 4
      },
      "lineNbr": 146,
      "author": {
        "id": 5770
      },
      "writtenOn": "2017-07-02T21:33:23Z",
      "side": 1,
      "message": "I think I can see from looking at commit message of https://github.com/upspin/upspin/commit/e9d1f956632790d5dfb45ecbdfbd9b7d3de04387.\n\nIn that case, let me ask this differently. Since this CL says \"Fix #389\", I understand #389 will be completely resolved as part of this CL. If that\u0027s the case, should it not revert https://github.com/upspin/upspin/commit/e9d1f956632790d5dfb45ecbdfbd9b7d3de04387 (and have tests succeed)? Or is this CL meant to only partially resolve #389 and doesn\u0027t plan to revert e9d1f956632790d5dfb45ecbdfbd9b7d3de04387?",
      "parentUuid": "cf9fd8c9_fbeb1fee",
      "revId": "639aa8d6edfa74a07f5778370f5dd2453384f8a0",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03",
      "unresolved": true
    }
  ]
}